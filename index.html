<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prickles and Goo - Tech Companies</title>
    <style>
        /* --- General Page Styles --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .main-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px 40px;
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        /* --- Typography and Content --- */
        h1 {
            font-size: 3em;
            color: #D32F2F;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #444;
        }
        
        p {
            color: #666;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        /* --- Voting & Results Area Styles --- */
        .item-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .item-card {
            border: 3px solid #ccc;
            border-radius: 8px;
            padding: 30px;
            min-width: 200px;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.2s ease;
            font-size: 1.5em;
            font-weight: bold;
        }

        .item-card:hover {
            transform: translateY(-5px);
            border-color: #007bff;
        }

        .results-area {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .result-item {
            margin-bottom: 20px;
        }

        .results-bar-container {
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            height: 30px;
            width: 100%;
            margin: 5px 0;
        }

        .prickly-fill {
            background-color: #dc3545; /* Prickly Red */
            height: 100%;
            transition: width 0.5s ease-in-out;
            color: white;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            box-sizing: border-box;
        }
        
        .gooey-fill {
             background-color: #28a745; /* Gooey Green */
             height: 100%;
             transition: width 0.5s ease-in-out;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <h1>Prickles and Goo</h1>

        <!-- The main area for voting. Starts visible. -->
        <div id="voting-area">
            <h2 id="current-category-title">Tech Companies</h2>
            <p>Which is more prickly or gooey? Click one to vote.</p>
            <div id="item-container" class="item-container">
                <div id="itemA-card" class="item-card">Loading...</div>
                <div id="itemB-card" class="item-card">Loading...</div>
            </div>
        </div>

        <!-- The area to show results after a vote. Hidden by default. -->
        <div id="results-area" class="hidden">
            <h2>Results</h2>
            <!-- Item A Results -->
            <div class="result-item">
                <h3 id="itemA-name"></h3>
                <div class="results-bar-container"><div id="itemA-prickly-bar" class="prickly-fill"></div></div>
                <p id="itemA-percentage"></p>
            </div>
            <!-- Item B Results -->
            <div class="result-item">
                <h3 id="itemB-name"></h3>
                <div class="results-bar-container"><div id="itemB-prickly-bar" class="prickly-fill"></div></div>
                <p id="itemB-percentage"></p>
            </div>
            <button id="next-pair-button">Vote on Next Pair</button>
        </div>
    </div>

    <!-- Import the Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

    <script>
        // === 1. FIREBASE SETUP ===
        const firebaseConfig = {
            apiKey: "AIzaSyDDmZ-MCtJMyuZKvQU1nWO02_Yw3zN01_g",
            authDomain: "prickles-or-goo.firebaseapp.com",
            projectId: "prickles-or-goo", // e.g., "prickles-and-goo-app"
            storageBucket: "prickles-or-goo.firebasestorage.app",
            messagingSenderId: "863779147603",
            appId: "1:863779147603:web:55f24624e9850d30715ba6"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // === 2. GLOBAL STATE & DOM ELEMENTS ===
        const currentCategoryId = "tech_companies"; // Hard-coded category
        let itemA = null; // Will store {id, name, pricklyVotes, gooeyVotes}
        let itemB = null;

        const votingArea = document.getElementById('voting-area');
        const resultsArea = document.getElementById('results-area');
        const itemA_card = document.getElementById('itemA-card');
        const itemB_card = document.getElementById('itemB-card');
        const nextPairButton = document.getElementById('next-pair-button');
        
        const itemA_name_res = document.getElementById('itemA-name');
        const itemB_name_res = document.getElementById('itemB-name');
        const itemA_bar_res = document.getElementById('itemA-prickly-bar');
        const itemB_bar_res = document.getElementById('itemB-prickly-bar');
        const itemA_perc_res = document.getElementById('itemA-percentage');
        const itemB_perc_res = document.getElementById('itemB-percentage');
        
        // === 3. CORE FUNCTIONS ===

        // Function to fetch two new random items from our category
        async function loadNewPair() {
            resultsArea.classList.add('hidden');
            votingArea.classList.remove('hidden');
            itemA_card.textContent = "Loading...";
            itemB_card.textContent = "Loading...";
            
            const itemsRef = db.collection('categories').doc(currentCategoryId).collection('items');
            const snapshot = await itemsRef.get();
            const allItems = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            // Simple shuffle and pick two different items
            allItems.sort(() => 0.5 - Math.random());
            
            itemA = allItems[0];
            itemB = allItems[1];

            itemA_card.textContent = itemA.name;
            itemB_card.textContent = itemB.name;
        }

        // Function to handle a user's vote
        async function handleVote(votedPricklyItem, votedGooeyItem) {
            // Get references to the documents in Firestore
            const pricklyRef = db.collection('categories').doc(currentCategoryId).collection('items').doc(votedPricklyItem.id);
            const gooeyRef = db.collection('categories').doc(currentCategoryId).collection('items').doc(votedGooeyItem.id);

            // Use Firestore's special `increment` function to safely update the counts
            await pricklyRef.update({ pricklyVotes: firebase.firestore.FieldValue.increment(1) });
            await gooeyRef.update({ gooeyVotes: firebase.firestore.FieldValue.increment(1) });
            
            // Update our local item objects with the new vote
            votedPricklyItem.pricklyVotes++;
            votedGooeyItem.gooeyVotes++;

            // Hide the voting area and show the results
            votingArea.classList.add('hidden');
            resultsArea.classList.remove('hidden');
            displayResults(votedPricklyItem, votedGooeyItem);
        }

        // Function to display the results
        function displayResults(item1, item2) {
            // Update Item A's results
            const totalVotesA = item1.pricklyVotes + item1.gooeyVotes;
            const pricklyPercentA = totalVotesA > 0 ? (item1.pricklyVotes / totalVotesA) * 100 : 0;
            itemA_name_res.textContent = item1.name;
            itemA_bar_res.style.width = pricklyPercentA + '%';
            itemA_perc_res.textContent = `${Math.round(pricklyPercentA)}% Prickly (${item1.pricklyVotes} votes)`;

            // Update Item B's results
            const totalVotesB = item2.pricklyVotes + item2.gooeyVotes;
            const pricklyPercentB = totalVotesB > 0 ? (item2.pricklyVotes / totalVotesB) * 100 : 0;
            itemB_name_res.textContent = item2.name;
            itemB_bar_res.style.width = pricklyPercentB + '%';
            itemB_perc_res.textContent = `${Math.round(pricklyPercentB)}% Prickly (${item2.pricklyVotes} votes)`;
        }
        
        // === 4. EVENT LISTENERS ===
        
        itemA_card.addEventListener('click', () => {
            if (itemA && itemB) handleVote(itemA, itemB); // Item A is voted prickly
        });
        
        itemB_card.addEventListener('click', () => {
            if (itemA && itemB) handleVote(itemB, itemA); // Item B is voted prickly
        });
        
        nextPairButton.addEventListener('click', loadNewPair);
        
        // === 5. INITIALIZATION ===
        // When the page first loads, immediately get the first pair of items
        loadNewPair();
    </script>
</body>
</html>
